<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Barn Reaper by HerdMate</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta
    name="description"
    content="Barn Reaper by HerdMate ‚Äì fast, export-ready livestock market reports. A SageWire Syndicate Product."
  />

  <!--
    //////////////////////////////////////////////////////////////
    // ü™® BLOCK 1 ‚Äî IDENTITY (LOCKED)
    // CaveCode ¬∑ HerdMate Tools Line
    //////////////////////////////////////////////////////////////
    TITLE: Barn Reaper ‚Äî Livestock Market Snapshot UI
    ID: HM-BR-UI-001
    LINE: HerdMate ¬∑ Market Tools
    VERSION: 1.0
    AUTHOR: Massive (HerdMate) & Ash (Forge)
    PURPOSE:
      Field-readable market snapshot screen for trucks, tractors, barns, and kitchen tables.
      Pulls cleaned market cuts from the Barn Reaper backend for quick decisions.
    DOMAIN:
      app / tool / monitor (frontend UI for FastAPI backend)

    RULES:
      - Block 1 defines WHAT this artifact is.
      - Do not ‚Äútune‚Äù or localize this block; treat it as a nameplate.
      - AI may read this block for context, but should not rewrite it automatically.
  -->

  <!--
    //////////////////////////////////////////////////////////////
    // üåê BLOCK 2 ‚Äî OVERVIEW (READ-ONLY SUMMARY)
    //////////////////////////////////////////////////////////////
    SCREEN:
      - Two-card layout:
          * Left: filters (commodity, region, weight class, date range, optional custom dates).
          * Right: live preview of table + export buttons.

    INPUTS:
      - commodity: required (e.g. feeder_steers, slaughter_cows).
      - region:   required (e.g. midwest, plains).
      - weight_class: optional weight bracket.
      - date_range:
          * latest   ‚Üí backend chooses most recent available reports.
          * 7d       ‚Üí last 7 days.
          * 30d      ‚Üí last 30 days.
          * custom   ‚Üí use date_from + date_to fields.
      - date_from / date_to:
          * Visible only when date_range = "custom".

    BACKEND CONTRACT (via /api/scrape POST):
      Request JSON:
        {
          "commodity":   "<code>",
          "region":      "<code>",
          "weight_class": "<code or ''>",
          "date_range":  "latest" | "7d" | "30d" | "custom",
          "date_from":   "YYYY-MM-DD" | null,
          "date_to":     "YYYY-MM-DD" | null
        }

      Response JSON (expected shape):
        {
          "summary": {
            "commodity_label": "Feeder Steers",
            "region_label":    "Midwest",
            "weight_label":    "500‚Äì600 lbs",
            "start_date":      "YYYY-MM-DD",
            "end_date":        "YYYY-MM-DD",
            "total_records":   42
          },
          "rows": [
            { "weight_range": "500-550", "avg_price": 2.34, "volume_head": 27, ... },
            ...
          ],
          "excel_url": "/download/excel/...",
          "pdf_url":   "/download/pdf/..."
        }

    OUTPUT:
      - On-screen, scrollable table with sticky header for quick reading.
      - Summary ‚Äúpill‚Äù line (commodity, region, weight bracket, date window, record count).
      - Excel / PDF export buttons wired to backend URLs.

    FIELD CONSTRAINTS:
      - Ember-gradient primary button: large, high contrast, readable in glare.
      - Simple selects only (no free-typing) to keep fat-finger errors low in the field.
      - Status line explains current state (ready, reaping, success, error).
  -->

  <style>
    :root {
      --hm-bg-deep: #05070b;
      --hm-panel: #0c1117;
      --hm-panel-soft: #111921;
      --hm-border: #1f2933;

      --hm-ember-top: #ffe4b8;
      --hm-ember-main: #f97316;
      --hm-ember-bottom: #b45309;

      --hm-text-main: #e5e7eb;
      --hm-text-soft: #9ca3af;
      --hm-text-muted: #6b7280;

      --hm-radius-xl: 26px;
      --hm-shadow-soft: 0 18px 40px rgba(15,23,42,0.75);
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background:
        linear-gradient(135deg, rgba(15,118,110,0.18), transparent 40%),
        radial-gradient(circle at top, #111827 0, #020617 55%);
      color: var(--hm-text-main);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .page-shell {
      max-width: 1100px;
      margin: 0 auto;
      padding: 1.25rem 1.25rem 2.5rem;
    }

    /* HEADER */
    header {
      margin: 0 0 1rem;
    }

    .header-banner {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
      padding: 0.9rem 1.1rem;
      border-radius: 20px;
      background: linear-gradient(to right, #050816, #020617);
      border: 1px solid rgba(148,163,184,0.25);
      box-shadow: 0 18px 40px rgba(0,0,0,0.75);
    }

    .brand-wrap {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .brand-icon {
      width: 44px;
      height: 44px;
      border-radius: 16px;
      background: radial-gradient(circle at 30% 20%, #f97316 0, #b91c1c 45%, #111827 90%);
      box-shadow: 0 12px 22px rgba(0,0,0,0.55);
    }

    .brand-title {
      font-weight: 800;
      letter-spacing: 0.06em;
      font-size: clamp(1.7rem, 2.6vw, 2.4rem);
      background: linear-gradient(to bottom, var(--hm-ember-top), var(--hm-ember-main), var(--hm-ember-bottom));
      -webkit-background-clip: text;
      color: transparent;
      -webkit-text-stroke: 1px #000000;
      text-shadow:
        0 0 2px #000000,
        0 2px 3px rgba(0,0,0,0.9),
        0 0 8px rgba(249,115,22,0.9),
        0 0 20px rgba(249,115,22,0.6);
    }

    .brand-sub {
      font-size: 0.8rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: rgba(249,250,251,0.8);
      text-shadow: 0 1px 2px rgba(0,0,0,0.9);
    }

    .tag-chip {
      padding: 0.25rem 0.7rem;
      border-radius: 999px;
      background: rgba(148,163,184,0.12);
      border: 1px solid rgba(148,163,184,0.45);
      font-size: 0.75rem;
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      color: var(--hm-text-soft);
      white-space: nowrap;
    }

    .tag-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: var(--hm-ember-main);
      box-shadow: 0 0 0 3px rgba(248,250,252,0.08);
    }

    main {
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 1.1fr);
      gap: 1.25rem;
    }

    @media (max-width: 960px) {
      main { grid-template-columns: minmax(0, 1fr); }
    }

    .card {
      background:
        radial-gradient(circle at top left, rgba(248,250,252,0.02), transparent 55%),
        radial-gradient(circle at bottom right, rgba(15,118,110,0.08), transparent 55%),
        var(--hm-panel);
      border-radius: var(--hm-radius-xl);
      border: 1px solid var(--hm-border);
      padding: 1.5rem 1.4rem 1.3rem;
      box-shadow: var(--hm-shadow-soft);
      position: relative;
      overflow: hidden;
    }

    .card-inner { position: relative; z-index: 1; }

    .card-title {
      font-size: 0.98rem;
      font-weight: 700;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: var(--hm-text-main);
      text-shadow: 0 1px 2px rgba(0,0,0,0.85);
      margin-bottom: 0.75rem;
    }

    .card-subtitle {
      font-size: 0.82rem;
      color: var(--hm-text-soft);
      margin-bottom: 1rem;
    }

    .field-grid {
      display: grid;
      grid-template-columns: minmax(0, 1fr);
      gap: 0.9rem;
    }

    @media (min-width: 720px) {
      .field-grid { grid-template-columns: repeat(2, 1fr); }
    }

    .field label {
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--hm-text-soft);
      text-shadow: 0 1px 2px rgba(0,0,0,0.8);
      margin-bottom: 0.25rem;
      display: block;
    }

    select, input[type="date"] {
      width: 100%;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.5);
      background: linear-gradient(to right, #020617, #020b10);
      color: var(--hm-text-main);
      padding: 0.55rem 0.9rem;
      font-size: 0.86rem;
      box-shadow: 0 0 0 1px rgba(15,23,42,0.85);
      outline: none;
    }

    select:focus, input[type="date"]:focus {
      border-color: var(--hm-ember-main);
      box-shadow: 0 0 0 1px rgba(249,115,22,0.4);
    }

    .btn-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.8rem;
      margin-top: 1.1rem;
      align-items: center;
    }

    .btn-primary {
      border: none;
      border-radius: 999px;
      padding: 0.7rem 1.8rem;
      min-width: 240px;
      min-height: 46px;
      font-size: 1.05rem;
      font-weight: 800;
      letter-spacing: 0.11em;
      text-transform: uppercase;
      color: #020617;
      background: radial-gradient(circle at 20% 0,
        var(--hm-ember-top) 0,
        var(--hm-ember-main) 40%,
        var(--hm-ember-bottom) 100%);
      border: 1px solid rgba(251,146,60,0.9);
      box-shadow:
        0 14px 28px rgba(0,0,0,0.75),
        0 0 16px rgba(249,115,22,0.75);
      text-shadow:
        0 1px 1px rgba(255,255,255,0.35),
        0 0 4px rgba(0,0,0,0.8);
    }

    .btn-primary:disabled { opacity: 0.55; box-shadow: none; }

    .btn-secondary {
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.55);
      background: rgba(15,23,42,0.7);
      color: var(--hm-text-soft);
      padding: 0.55rem 1.3rem;
      font-size: 0.82rem;
      cursor: pointer;
    }

    .status-text {
      font-size: 0.78rem;
      color: var(--hm-text-soft);
    }
    .status-text.error   { color: #f97373; }
    .status-text.success { color: #4ade80; }

    .empty-state {
      font-size: 0.8rem;
      color: var(--hm-text-muted);
      padding-top: 0.8rem;
    }

    .export-row {
      margin-top: 1rem;
      display: flex;
      gap: 0.8rem;
      flex-wrap: wrap;
    }

    .table-wrap {
      margin-top: 0.5rem;
      border-radius: 14px;
      border: 1px solid rgba(30,41,59,0.85);
      background: #020617;
      overflow: auto;
      max-height: 380px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.8rem;
      color: var(--hm-text-soft);
    }

    thead {
      background: rgba(15,23,42,0.95);
      position: sticky;
      top: 0;
      z-index: 1;
    }

    th, td {
      padding: 0.5rem 0.55rem;
      border-bottom: 1px solid rgba(30,41,59,0.85);
      white-space: nowrap;
      text-align: left;
    }

    th {
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: var(--hm-text-main);
      font-size: 0.75rem;
    }

    tbody tr:nth-child(even) {
      background: rgba(15,23,42,0.75);
    }

    tbody tr:hover {
      background: rgba(30,64,175,0.75);
    }

    footer {
      text-align: center;
      padding: 1.25rem;
      font-size: 0.75rem;
      color: var(--hm-text-muted);
    }
  </style>
</head>

<body>
  <div class="page-shell">
    <header>
      <div class="header-banner">
        <div class="brand-wrap">
          <div class="brand-icon" aria-hidden="true"></div>
          <div>
            <div class="brand-title">HerdMate</div>
            <div class="brand-sub">Barn Reaper ¬∑ Livestock Market Snapshot</div>
          </div>
        </div>
        <div class="tag-chip">
          <span class="tag-dot"></span>
          MVP Forge
        </div>
      </div>
    </header>

    <main>
      <!-- FILTER CARD -->
      <section class="card">
        <div class="card-inner">
          <h2 class="card-title">Reap a Market Snapshot</h2>
          <p class="card-subtitle">
            Choose commodity, region, and time window. Barn Reaper will harvest a clean,
            export-ready cut of the market.
          </p>

          <div class="field-grid">
            <div class="field">
              <label for="commodity">Commodity</label>
              <select id="commodity">
                <option value="">Select commodity...</option>
                <option value="feeder_steers">Feeder Steers</option>
                <option value="feeder_heifers">Feeder Heifers</option>
                <option value="slaughter_cows">Slaughter Cows</option>
                <option value="slaughter_bulls">Slaughter Bulls</option>
                <option value="pairs_cow_calf">Pairs / Cow-Calf</option>
                <option value="calves_unweaned">Calves (Unweaned)</option>
                <option value="other">Other / Mixed</option>
              </select>
            </div>

            <div class="field">
              <label for="region">Region</label>
              <select id="region">
                <option value="">Select region...</option>
                <option value="midwest">Midwest</option>
                <option value="plains">Plains</option>
                <option value="tx_ok">Texas / Oklahoma</option>
                <option value="southeast">Southeast</option>
                <option value="mountain_west">Mountain West</option>
                <option value="nationwide">Nationwide</option>
              </select>
            </div>

            <div class="field">
              <label for="weight_class">Weight Class (optional)</label>
              <select id="weight_class">
                <option value="">Any / Not specified</option>
                <option value="300_400">300‚Äì400 lbs</option>
                <option value="400_500">400‚Äì500 lbs</option>
                <option value="500_600">500‚Äì600 lbs</option>
                <option value="600_700">600‚Äì700 lbs</option>
                <option value="700_800">700‚Äì800 lbs</option>
                <option value="800_plus">800+ lbs</option>
              </select>
            </div>

            <div class="field">
              <label for="date_range">Date Range</label>
              <select id="date_range">
                <option value="latest">Latest reports</option>
                <option value="7d">Last 7 days</option>
                <option value="30d">Last 30 days</option>
                <option value="custom">Custom range</option>
              </select>
            </div>

            <div class="field" id="date_from_wrap" style="display:none;">
              <label for="date_from">From (date)</label>
              <input id="date_from" type="date" />
            </div>

            <div class="field" id="date_to_wrap" style="display:none;">
              <label for="date_to">To (date)</label>
              <input id="date_to" type="date" />
            </div>
          </div>

          <div class="btn-row">
            <button id="run-report" class="btn-primary">
              Reap Market Data
            </button>
            <button id="clear-filters" class="btn-secondary">
              Reset
            </button>
            <span id="status-text" class="status-text">
              Ready. Choose filters and let Barn Reaper work the market.
            </span>
          </div>
        </div>
      </section>

      <!-- PREVIEW CARD -->
      <section class="card">
        <div class="card-inner">
          <h2 class="card-title">Today's Cut</h2>
          <p class="card-subtitle">
            Live data snapshot. Export to Excel or PDF for herd meetings, lenders, or sale-day prep.
          </p>

          <div id="summary-pill" class="status-text" style="margin-bottom:0.75rem; display:none;"></div>

          <div id="report-preview">
            <div class="empty-state">
              No snapshot yet. Run Barn Reaper to harvest live data here.
            </div>
          </div>

          <div class="export-row">
            <button id="export-excel" class="btn-secondary" disabled>Excel</button>
            <button id="export-pdf" class="btn-secondary" disabled>PDF</button>
          </div>
        </div>
      </section>
    </main>

    <footer>
      ¬© HerdMate ¬∑ Barn Reaper ¬∑ A SageWire Syndicate Product.<br />
      ‚ÄúThere are no sale prices safe from the Barn Reaper.‚Äù
    </footer>
  </div>

  <script>
    (function () {
      // ////////////////////////////////////////////////////////////
      // üéöÔ∏è BLOCK 3 ‚Äî TUNING KNOBS (HUMAN-EDITABLE)
      // ////////////////////////////////////////////////////////////
      // Backend endpoint for Barn Reaper scrape engine.
      // Adjust if you mount the API behind a path prefix or proxy.
      const SCRAPE_URL    = "/api/scrape";

      // Optional: centralize status message text for easy tweaking.
      const STATUS_MESSAGES = {
        idle:    "Ready. Choose filters and let Barn Reaper work the market.",
        loading: "Reaping live market data from the Barn Reaper engine‚Ä¶",
        ok:      "Report generated successfully. Review or export it.",
        error:   "Could not retrieve market data. Try again shortly or adjust filters."
      };

      // ////////////////////////////////////////////////////////////
      // üîß BLOCK 4 ‚Äî UI WIRING & ENGINE (BEHAVIOR)
      // ////////////////////////////////////////////////////////////

      const commodityEl   = document.getElementById("commodity");
      const regionEl      = document.getElementById("region");
      const weightEl      = document.getElementById("weight_class");
      const dateRangeEl   = document.getElementById("date_range");
      const dateFromWrap  = document.getElementById("date_from_wrap");
      const dateToWrap    = document.getElementById("date_to_wrap");
      const dateFromEl    = document.getElementById("date_from");
      const dateToEl      = document.getElementById("date_to");

      const runBtn        = document.getElementById("run-report");
      const resetBtn      = document.getElementById("clear-filters");
      const statusText    = document.getElementById("status-text");

      const summaryPill   = document.getElementById("summary-pill");
      const previewEl     = document.getElementById("report-preview");
      const excelBtn      = document.getElementById("export-excel");
      const pdfBtn        = document.getElementById("export-pdf");

      let lastExcelUrl = null;
      let lastPdfUrl   = null;

      function setStatus(msg, type) {
        statusText.textContent = msg;
        statusText.className = "status-text";
        if (type === "error")   statusText.classList.add("error");
        if (type === "success") statusText.classList.add("success");
      }

      function setLoading(isLoading) {
        runBtn.disabled = isLoading;
        runBtn.textContent = isLoading ? "Reaping‚Ä¶" : "Reap Market Data";
        if (isLoading) {
          setStatus(STATUS_MESSAGES.loading, null);
        }
      }

      function resetResults() {
        previewEl.innerHTML = `
          <div class="empty-state">
            No snapshot yet. Run Barn Reaper to harvest live data here.
          </div>
        `;
        excelBtn.disabled = true;
        pdfBtn.disabled   = true;
        summaryPill.style.display = "none";
        lastExcelUrl = null;
        lastPdfUrl   = null;
      }

      function toggleCustomDates() {
        const isCustom = dateRangeEl.value === "custom";
        dateFromWrap.style.display = isCustom ? "block" : "none";
        dateToWrap.style.display   = isCustom ? "block" : "none";
        if (!isCustom) {
          dateFromEl.value = "";
          dateToEl.value   = "";
        }
      }

      dateRangeEl.addEventListener("change", toggleCustomDates);
      toggleCustomDates();

      function buildPayload() {
        return {
          commodity:    commodityEl.value || "",
          region:       regionEl.value || "",
          weight_class: weightEl.value || "",
          date_range:   dateRangeEl.value || "latest",
          date_from:    dateFromEl.value || null,
          date_to:      dateToEl.value || null,
        };
      }

      function renderSummary(summary) {
        if (!summary) {
          summaryPill.style.display = "none";
          return;
        }
        const {
          commodity_label,
          region_label,
          weight_label,
          start_date,
          end_date,
          total_records,
        } = summary;

        const bits = [];
        if (commodity_label) bits.push(commodity_label);
        if (region_label)    bits.push(region_label);
        if (weight_label)    bits.push(weight_label);
        if (start_date && end_date) {
          bits.push(start_date + " \u2192 " + end_date);
        } else if (start_date) {
          bits.push("From " + start_date);
        }
        if (typeof total_records === "number") {
          bits.push(total_records + " records");
        }

        summaryPill.textContent = bits.join(" ‚Ä¢ ");
        summaryPill.style.display = bits.length ? "inline-block" : "none";
      }

      function renderTable(rows) {
        if (!rows || !rows.length) {
          previewEl.innerHTML = `
            <div class="empty-state">
              No records returned for the selected filters.
            </div>
          `;
          return;
        }

        const keys = Object.keys(rows[0]);
        const thead = `
          <thead>
            <tr>${keys.map(k => `<th>${k.replace(/_/g," ")}</th>`).join("")}</tr>
          </thead>
        `;
        const tbody = `
          <tbody>
            ${rows.map(row => `
              <tr>
                ${keys.map(k => `<td>${row[k] == null ? "" : String(row[k])}</td>`).join("")}
              </tr>
            `).join("")}
          </tbody>
        `;

        previewEl.innerHTML = `
          <div class="table-wrap">
            <table>${thead}${tbody}</table>
          </div>
        `;
      }

      excelBtn.addEventListener("click", () => {
        if (lastExcelUrl) window.open(lastExcelUrl, "_blank");
      });

      pdfBtn.addEventListener("click", () => {
        if (lastPdfUrl) window.open(lastPdfUrl, "_blank");
      });

      async function runReport() {
        const payload = buildPayload();

        if (!payload.commodity || !payload.region) {
          setStatus("Please select at least a commodity and region.", "error");
          return;
        }
        if (payload.date_range === "custom" && (!payload.date_from || !payload.date_to)) {
          setStatus("Please choose both From and To dates for a custom range.", "error");
          return;
        }

        resetResults();
        setLoading(true);

        try {
          const resp = await fetch(SCRAPE_URL, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload),
          });

          if (!resp.ok) throw new Error("HTTP " + resp.status);
          const data = await resp.json();

          renderSummary(data.summary || null);
          renderTable(data.rows || []);

          lastExcelUrl = data.excel_url || null;
          lastPdfUrl   = data.pdf_url || null;

          excelBtn.disabled = !lastExcelUrl;
          pdfBtn.disabled   = !lastPdfUrl;

          setStatus(STATUS_MESSAGES.ok, "success");
        } catch (err) {
          console.error("Barn Reaper error:", err);
          resetResults();
          setStatus(
            STATUS_MESSAGES.error,
            "error"
          );
        } finally {
          setLoading(false);
        }
      }

      function resetFilters() {
        commodityEl.value = "";
        regionEl.value    = "";
        weightEl.value    = "";
        dateRangeEl.value = "latest";
        dateFromEl.value  = "";
        dateToEl.value    = "";
        toggleCustomDates();
        resetResults();
        setStatus(STATUS_MESSAGES.idle, null);
      }

      runBtn.addEventListener("click", (e) => { e.preventDefault(); runReport(); });
      resetBtn.addEventListener("click", (e) => { e.preventDefault(); resetFilters(); });

      resetFilters(); // initial state
    })();
  </script>

  <!--
    //////////////////////////////////////////////////////////////
    // üìù BLOCK 5 ‚Äî HUMAN NOTES (APPEND ONLY)
    //////////////////////////////////////////////////////////////
    [NOTE]
      - This file is the RanchBoardroom / Barn Reaper UI only.
      - Backend is a FastAPI (or similar) service mounted at SCRAPE_URL.

    [NOTE ‚Äî FIELD USAGE]
      - Primary button is intentionally oversized + ember gradient for daylight visibility.
      - Table uses sticky header + alternating rows for quick scan on small screens.

    [INTEGRATION CHECKLIST]
      - Confirm /api/scrape is reachable from the same origin as this page.
      - Confirm response JSON has keys: summary, rows, excel_url, pdf_url.
      - If you mount the API under a prefix (e.g. /barnreaper/api/scrape),
        change SCRAPE_URL in Block 3.

    [FUTURE IDEAS]
      - Add presets: e.g. ‚ÄúFeeder Steers ¬∑ Midwest ¬∑ Last 7 days‚Äù buttons.
      - Add a ‚ÄúCompare vs last sale‚Äù small trend chip under the summary-pill.
      - Pipe one-click exports directly into a HerdMate report packet.
  -->

</body>
</html>
