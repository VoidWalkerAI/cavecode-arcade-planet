<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Torchline Sprint · ARC-TS-001</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />

  <!--
    BLOCK 1 — SHELL & BRAND (LOCKED)
    CaveCode Arcade Planet · Track Runner Line
  -->
  <style>
    :root {
      --cc-bg: #020617;
      --cc-panel: #02081b;
      --cc-panel-soft: #0b1120;
      --cc-border: #1f2937;
      --cc-accent: #fb923c;
      --cc-accent-soft: #fed7aa;
      --cc-text-main: #e5e7eb;
      --cc-text-soft: #9ca3af;
      --runner: #22c55e;
      --ground: #111827;
      --hazard: #ef4444;
      --pit: #000000;
      --coin: #facc15;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      background: radial-gradient(circle at top, #111827 0, #020617 55%);
      color: var(--cc-text-main);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 1.25rem 0.75rem 2.5rem;
    }

    header {
      width: 100%;
      max-width: 960px;
      background: linear-gradient(135deg, #020617, #030712);
      border-radius: 999px;
      border: 1px solid var(--cc-border);
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.7);
      padding: 0.9rem 1.3rem;
      display: flex;
      flex-direction: column;
      gap: 0.3rem;
    }

    @media (min-width: 640px) {
      header {
        flex-direction: row;
        align-items: baseline;
        justify-content: space-between;
      }
    }

    .title-line {
      font-size: clamp(1.05rem, 2.4vw, 1.3rem);
      font-weight: 700;
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    .title-line span {
      color: var(--cc-accent-soft);
    }

    .subtitle-line {
      display: flex;
      flex-wrap: wrap;
      gap: 0.35rem;
      margin-top: 0.15rem;
    }

    .badge {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      padding: 0.18rem 0.6rem;
      border-radius: 999px;
      border: 1px solid var(--cc-border);
      background: #020617;
      color: var(--cc-text-soft);
      white-space: nowrap;
    }

    .badge.accent {
      border-color: var(--cc-accent);
      color: var(--cc-accent-soft);
      background: radial-gradient(circle at top left, rgba(251, 146, 60, 0.35), #020617);
    }

    main {
      width: 100%;
      max-width: 960px;
      margin-top: 1.2rem;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .panel {
      background: radial-gradient(circle at top left, #020617, #020617 40%, #000 100%);
      border-radius: 1.3rem;
      border: 1px solid var(--cc-border);
      box-shadow: 0 18px 40px rgba(0,0,0,0.8);
      padding: 1rem 1.1rem 1.1rem;
    }

    .panel-header-row {
      display: flex;
      flex-direction: column;
      gap: 0.4rem;
      margin-bottom: 0.6rem;
    }

    .panel-title {
      font-size: 0.9rem;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      color: var(--cc-text-soft);
    }

    .panel-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 0.35rem;
    }

    .panel-tags .badge {
      font-size: 0.65rem;
    }

    .panel-body p {
      margin: 0.25rem 0 0.45rem;
      font-size: 0.86rem;
      color: var(--cc-text-soft);
      line-height: 1.45;
    }

    .stat-grid {
      margin-top: 0.5rem;
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 0.5rem;
    }

    @media (min-width: 720px) {
      .stat-grid {
        grid-template-columns: repeat(6, minmax(0, 1fr));
      }
    }

    .stat-chip {
      background: #020617;
      border-radius: 0.8rem;
      border: 1px solid var(--cc-border);
      padding: 0.4rem 0.55rem;
      font-size: 0.7rem;
      display: flex;
      flex-direction: column;
      gap: 0.1rem;
    }

    .stat-label {
      text-transform: uppercase;
      letter-spacing: 0.09em;
      color: var(--cc-text-soft);
    }

    .stat-value {
      font-size: 0.8rem;
      font-weight: 600;
    }

    .stat-value.accent {
      color: var(--cc-accent-soft);
    }

    .playfield-wrap {
      margin-top: 0.7rem;
      border-radius: 1rem;
      border: 1px solid var(--cc-border);
      background: radial-gradient(circle at top, #020617 0, #000 80%);
      padding: 0.75rem;
    }

    #playfield {
      position: relative;
      margin: 0 auto;
      width: min(480px, 100%);
      height: min(280px, 75vw);
      max-height: 320px;
      background: radial-gradient(circle at 50% 0%, #020617 0, #020617 40%, #000 95%);
      border-radius: 0.9rem;
      overflow: hidden;
      border: 1px solid #020617;
      touch-action: none;
    }

    .bg-stars {
      position: absolute;
      inset: 0;
      background-image:
        radial-gradient(circle at 10% 15%, rgba(148,163,184,0.25) 0, transparent 55%),
        radial-gradient(circle at 80% 40%, rgba(55,65,81,0.4) 0, transparent 55%);
      opacity: 0.35;
      pointer-events: none;
    }

    #ground {
      position: absolute;
      left: 0;
      bottom: 0;
      width: 200%;
      height: 50px;
      background: repeating-linear-gradient(
        -45deg,
        var(--ground),
        var(--ground) 12px,
        #0b1220 12px,
        #0b1220 24px
      );
    }

    #runner {
      position: absolute;
      width: 26px;
      height: 32px;
      border-radius: 0.3rem;
      background: radial-gradient(circle at 20% 0%, #bbf7d0, var(--runner));
      box-shadow: 0 0 12px rgba(34,197,94,0.9);
      left: 60px;
      bottom: 50px;
    }

    .hazard {
      position: absolute;
      bottom: 50px;
      width: 18px;
      height: 24px;
      background: linear-gradient(to top, var(--hazard), #fecaca);
      clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
      box-shadow: 0 0 10px rgba(248,113,113,0.9);
    }

    .pit {
      position: absolute;
      bottom: 0;
      width: 52px;
      height: 50px;
      background: radial-gradient(circle at top, #020617 0, var(--pit) 70%);
    }

    .coin {
      position: absolute;
      width: 14px;
      height: 14px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 0%, #fef9c3, var(--coin));
      box-shadow: 0 0 10px rgba(250,204,21,0.8);
    }

    .controls-row {
      margin-top: 0.65rem;
      display: flex;
      flex-wrap: wrap;
      gap: 0.55rem;
      justify-content: center;
    }

    .btn {
      border-radius: 999px;
      border: 1px solid var(--cc-border);
      background: #020617;
      color: var(--cc-text-main);
      font-size: 0.8rem;
      padding: 0.45rem 0.95rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.25rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--cc-accent), #f97316);
      border-color: #fb923c;
      color: #111827;
      font-weight: 600;
      box-shadow: 0 12px 30px rgba(248,113,113,0.45);
    }

    .btn:disabled {
      opacity: 0.45;
      cursor: default;
      box-shadow: none;
    }

    .hint {
      margin-top: 0.6rem;
      font-size: 0.78rem;
      color: var(--cc-text-soft);
      text-align: center;
    }

    footer {
      margin-top: 1.4rem;
      font-size: 0.78rem;
      color: var(--cc-text-soft);
      text-align: center;
    }

    footer span {
      color: var(--cc-accent-soft);
    }

    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(15,23,42,0.85);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 40;
    }

    .modal {
      background: radial-gradient(circle at top, #020617, #000 85%);
      border-radius: 1rem;
      border: 1px solid var(--cc-border);
      box-shadow: 0 20px 45px rgba(0,0,0,0.95);
      padding: 1.1rem 1.3rem 1rem;
      max-width: 360px;
      width: 90%;
      text-align: center;
    }

    .modal h2 {
      margin: 0 0 0.4rem;
      font-size: 1rem;
      letter-spacing: 0.14em;
      text-transform: uppercase;
    }

    .modal p {
      margin: 0.25rem 0 0.75rem;
      font-size: 0.85rem;
      color: var(--cc-text-soft);
    }

    .modal-actions {
      display: flex;
      justify-content: center;
      gap: 0.55rem;
    }

    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <header>
    <div>
      <div class="title-line">
        TRACK RUNNER — <span>TORCHLINE SPRINT</span> · ARC-TS-001
      </div>
      <div class="subtitle-line">
        <span class="badge">CaveCode Arcade Planet</span>
        <span class="badge">One-Button Runner</span>
        <span class="badge accent">Jump the Pits</span>
      </div>
    </div>
  </header>

  <main>
    <!-- BLOCK 2 — TRACK OVERVIEW -->
    <section class="panel">
      <div class="panel-header-row">
        <div class="panel-title">Track Overview</div>
        <div class="panel-tags">
          <span class="badge">Auto-Run</span>
          <span class="badge">Pits & Spikes</span>
          <span class="badge">Distance Scorer</span>
          <span class="badge">Rising Speed</span>
        </div>
      </div>
      <div class="panel-body">
        <p>
          The torchline runs along the cavern floor. You sprint automatically; you only control when to leap.
          Time your jumps to clear pits and spikes. The longer you stay alive, the faster the line pulls you forward.
        </p>
        <p>
          Tap / click / Space / W / ↑ to jump. Survive as long as you can and chase a cleaner run.
        </p>
      </div>

      <div class="stat-grid">
        <div class="stat-chip">
          <div class="stat-label">Speed</div>
          <div class="stat-value" id="stat-speed">1.0x</div>
        </div>
        <div class="stat-chip">
          <div class="stat-label">Distance</div>
          <div class="stat-value" id="stat-distance">0 m</div>
        </div>
        <div class="stat-chip">
          <div class="stat-label">Best</div>
          <div class="stat-value" id="stat-best">0 m</div>
        </div>
        <div class="stat-chip">
          <div class="stat-label">Coins</div>
          <div class="stat-value" id="stat-coins">0</div>
        </div>
        <div class="stat-chip">
          <div class="stat-label">Runs</div>
          <div class="stat-value" id="stat-runs">0</div>
        </div>
        <div class="stat-chip">
          <div class="stat-label">Last</div>
          <div class="stat-value" id="stat-last">0 m</div>
        </div>
      </div>
    </section>

    <!-- BLOCK 3 — PLAYFIELD + CONTROLS -->
    <section class="panel">
      <div class="playfield-wrap">
        <div id="playfield">
          <div class="bg-stars"></div>
          <div id="ground"></div>
          <div id="runner"></div>
        </div>
      </div>

      <div class="controls-row">
        <button class="btn btn-primary" id="jumpBtn">Jump</button>
        <button class="btn" id="restartBtn">Restart</button>
      </div>

      <p class="hint">
        Tap or click inside the track (or press <strong>Space / ↑ / W</strong>) to jump.  
        Clear pits and spikes. Speed slowly rises the longer you survive.
      </p>
    </section>
  </main>

  <footer>
    Keep the torch ahead of the dark. Forged in
    <span>CaveCode Arcade Planet</span> · <span>SageWire Syndicate</span>.
  </footer>

  <!-- Modal -->
  <div id="modalBackdrop" class="modal-backdrop hidden">
    <div class="modal">
      <h2 id="modalTitle">Run Over</h2>
      <p id="modalBody">You hit something on the torchline.</p>
      <div class="modal-actions">
        <button class="btn btn-primary" id="modalPrimary">Run Again</button>
      </div>
    </div>
  </div>

  <!--
    BLOCK 4 — GAME LOGIC (EDITABLE)
    Torchline Sprint · One-Button Track Runner
  -->
  <script>
    // ---- DOM HOOKS ----
    const playfield = document.getElementById("playfield");
    const runnerEl = document.getElementById("runner");
    const groundEl = document.getElementById("ground");

    const statSpeed = document.getElementById("stat-speed");
    const statDistance = document.getElementById("stat-distance");
    const statBest = document.getElementById("stat-best");
    const statCoins = document.getElementById("stat-coins");
    const statRuns = document.getElementById("stat-runs");
    const statLast = document.getElementById("stat-last");

    const jumpBtn = document.getElementById("jumpBtn");
    const restartBtn = document.getElementById("restartBtn");

    const modalBackdrop = document.getElementById("modalBackdrop");
    const modalTitle = document.getElementById("modalTitle");
    const modalBody = document.getElementById("modalBody");
    const modalPrimary = document.getElementById("modalPrimary");

    // ---- STATE ----
    let running = false;
    let lastTime = null;

    let runnerY = 50;      // bottom offset above ground
    let runnerVY = 0;
    const runnerWidth = 26;
    const runnerHeight = 32;

    const GROUND_HEIGHT = 50;
    const GRAVITY = -0.0018;
    const JUMP_VELOCITY = 0.56;

    let distance = 0;
    let bestDistance = 0;
    let lastDistance = 0;
    let coinsCollected = 0;
    let totalRuns = 0;

    let baseSpeed = 150;   // px/sec base scroll speed
    let speedMultiplier = 1.0;
    let groundOffset = 0;

    let hazardIdCounter = 0;
    let coinIdCounter = 0;
    const hazards = new Map();
    const coins = new Map();

    let spawnTimer = 0;
    let coinTimer = 0;

    let audioCtx = null;

    function ensureAudio() {
      if (!audioCtx) {
        try {
          audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        } catch (e) {
          audioCtx = null;
        }
      }
    }

    function beep(freq, duration, gainVal = 0.06) {
      if (!audioCtx) return;
      const ctx = audioCtx;
      const osc = ctx.createOscillator();
      const gain = ctx.createGain();
      osc.type = "sine";
      osc.frequency.value = freq;
      gain.gain.value = gainVal;
      osc.connect(ctx.destination);
      const now = ctx.currentTime;
      osc.start(now);
      osc.stop(now + duration);
    }

    function sfxJump() {
      ensureAudio();
      beep(720, 0.08, 0.05);
    }

    function sfxHit() {
      ensureAudio();
      beep(240, 0.18, 0.08);
    }

    function sfxCoin() {
      ensureAudio();
      beep(900, 0.06, 0.06);
    }

    // ---- INIT / RESET ----
    function resetRun() {
      const pfHeight = playfield.clientHeight;

      running = true;
      lastTime = null;

      distance = 0;
      speedMultiplier = 1.0;
      groundOffset = 0;

      runnerY = GROUND_HEIGHT;
      runnerVY = 0;

      hazards.forEach(h => h.el.remove());
      hazards.clear();
      coins.forEach(c => c.el.remove());
      coins.clear();
      spawnTimer = 0;
      coinTimer = 0;

      statSpeed.textContent = speedMultiplier.toFixed(1) + "x";
      statDistance.textContent = "0 m";

      applyRunnerTransform();
      applyGroundTransform();

      requestAnimationFrame(gameLoop);
    }

    // ---- OBJECT SPAWN ----
    function spawnHazardPattern() {
      const patternRoll = Math.random();

      const pfWidth = playfield.clientWidth;
      const startX = pfWidth + 30;

      if (patternRoll < 0.4) {
        // Single spike
        createSpike(startX);
      } else if (patternRoll < 0.7) {
        // Double spike cluster
        createSpike(startX);
        createSpike(startX + 30);
      } else {
        // Pit (jump over gap)
        createPit(startX);
      }
    }

    function createSpike(x) {
      const el = document.createElement("div");
      el.className = "hazard";
      el.style.left = x + "px";
      playfield.appendChild(el);

      const id = hazardIdCounter++;
      hazards.set(id, {
        id,
        el,
        x,
        width: 18,
        type: "spike"
      });
    }

    function createPit(x) {
      const el = document.createElement("div");
      el.className = "pit";
      el.style.left = x + "px";
      playfield.appendChild(el);

      const id = hazardIdCounter++;
      hazards.set(id, {
        id,
        el,
        x,
        width: 52,
        type: "pit"
      });
    }

    function spawnCoin() {
      const pfWidth = playfield.clientWidth;
      const x = pfWidth + 20;
      const y = GROUND_HEIGHT + 36 + Math.random() * 40;

      const el = document.createElement("div");
      el.className = "coin";
      el.style.left = x + "px";
      el.style.bottom = y + "px";
      playfield.appendChild(el);

      const id = coinIdCounter++;
      coins.set(id, {
        id,
        el,
        x,
        y,
        width: 14,
        height: 14
      });
    }

    // ---- GAME LOOP ----
    function gameLoop(timestamp) {
      if (!running) return;
      if (lastTime == null) lastTime = timestamp;
      const deltaMs = timestamp - lastTime;
      lastTime = timestamp;
      const dt = deltaMs / 1000;

      // speed ramps gently over time
      speedMultiplier += dt * 0.03;
      const scrollSpeed = baseSpeed * speedMultiplier;

      // distance in "meters"
      distance += scrollSpeed * dt * 0.04;
      statDistance.textContent = Math.floor(distance) + " m";
      statSpeed.textContent = speedMultiplier.toFixed(1) + "x";

      // runner physics
      runnerVY += GRAVITY * deltaMs;
      const minY = GROUND_HEIGHT;
      runnerY += runnerVY * deltaMs;

      // clamp to ground
      if (runnerY <= minY) {
        runnerY = minY;
        runnerVY = 0;
      }

      applyRunnerTransform();

      // scroll ground texture
      groundOffset -= scrollSpeed * dt * 0.25;
      applyGroundTransform();

      // move hazards & coins
      hazards.forEach((h, id) => {
        h.x -= scrollSpeed * dt;
        h.el.style.left = h.x + "px";

        if (h.x < -80) {
          h.el.remove();
          hazards.delete(id);
        }
      });

      coins.forEach((c, id) => {
        c.x -= scrollSpeed * dt;
        c.el.style.left = c.x + "px";
        if (c.x < -40) {
          c.el.remove();
          coins.delete(id);
        }
      });

      // spawn timers
      spawnTimer += deltaMs;
      coinTimer += deltaMs;

      const spawnInterval = 880 - Math.min(400, (speedMultiplier - 1.0) * 200);
      if (spawnTimer >= spawnInterval) {
        spawnTimer = 0;
        spawnHazardPattern();
      }

      const coinInterval = 1200;
      if (coinTimer >= coinInterval) {
        coinTimer = 0;
        if (Math.random() < 0.65) spawnCoin();
      }

      // collisions
      if (checkHazardCollision()) {
        handleDeath("You hit a pit or spike on the torchline.");
        return;
      }

      checkCoinCollisions();

      requestAnimationFrame(gameLoop);
    }

    function applyRunnerTransform() {
      runnerEl.style.bottom = runnerY + "px";
    }

    function applyGroundTransform() {
      groundEl.style.transform = `translateX(${groundOffset}px)`;
    }

    // ---- COLLISIONS ----
    function getRunnerRect() {
      const rect = runnerEl.getBoundingClientRect();
      return rect;
    }

    function checkHazardCollision() {
      const r = getRunnerRect();

      let hit = false;
      hazards.forEach(h => {
        const rect = h.el.getBoundingClientRect();

        const overlap =
          rect.left < r.right - 6 &&
          rect.right > r.left + 6 &&
          rect.top < r.bottom &&
          rect.bottom > r.top + 4;

        if (overlap) hit = true;
      });

      return hit;
    }

    function checkCoinCollisions() {
      const r = getRunnerRect();

      coins.forEach((c, id) => {
        const rect = c.el.getBoundingClientRect();
        const overlap =
          rect.left < r.right - 4 &&
          rect.right > r.left + 4 &&
          rect.top < r.bottom - 4 &&
          rect.bottom > r.top + 4;

        if (overlap) {
          coinsCollected += 1;
          statCoins.textContent = coinsCollected.toString();
          sfxCoin();
          c.el.remove();
          coins.delete(id);
        }
      });
    }

    // ---- OUTCOME ----
    function handleDeath(message) {
      running = false;
      sfxHit();

      lastDistance = Math.floor(distance);
      bestDistance = Math.max(bestDistance, lastDistance);

      totalRuns += 1;

      statBest.textContent = bestDistance + " m";
      statRuns.textContent = totalRuns.toString();
      statLast.textContent = lastDistance + " m";

      modalTitle.textContent = "Run Over";
      modalBody.textContent = message + " You ran " + lastDistance + " m.";
      modalBackdrop.classList.remove("hidden");
    }

    function hideModal() {
      modalBackdrop.classList.add("hidden");
    }

    // ---- CONTROLS ----
    function doJump() {
      if (!running) return;
      if (runnerY > GROUND_HEIGHT + 2) return; // no double jump
      runnerVY = JUMP_VELOCITY;
      sfxJump();
    }

    playfield.addEventListener("pointerdown", () => {
      doJump();
    });

    jumpBtn.addEventListener("click", () => {
      doJump();
    });

    restartBtn.addEventListener("click", () => {
      hideModal();
      resetRun();
    });

    modalPrimary.addEventListener("click", () => {
      hideModal();
      resetRun();
    });

    modalBackdrop.addEventListener("click", (e) => {
      if (e.target === modalBackdrop) {
        hideModal();
        resetRun();
      }
    });

    window.addEventListener("keydown", (e) => {
      if (e.code === "Space" || e.code === "ArrowUp" || e.code === "KeyW") {
        e.preventDefault();
        doJump();
      }
    });

    // ---- BOOT ----
    window.addEventListener("load", () => {
      resetRun();
    });
  </script>
</body>
</html>
